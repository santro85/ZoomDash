<!DOCTYPE html>
<html lang="en">

<head>
    <title>Transactions</title>
    <!-- HTML5 Shim and Respond.js IE10 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 10]>
		<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
		<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
		<![endif]-->
    <!-- Meta -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="description"
        content="Datta Able Bootstrap admin template made using Bootstrap 4 and it has huge amount of ready made feature, UI components, pages which completely fulfills any dashboard needs." />
    <meta name="keywords"
        content="admin templates, bootstrap admin templates, bootstrap 4, dashboard, dashboard templets, sass admin templets, html admin templates, responsive, bootstrap admin templates free download,premium bootstrap admin templates, datta able, datta able bootstrap admin template, free admin theme, free dashboard template" />
    <meta name="author" content="CodedThemes" />

    <!-- Favicon icon -->
    <link rel="icon" href="assets/images/favicon.ico" type="image/x-icon">
    <!-- fontawesome icon -->
    <link rel="stylesheet" href="assets/fonts/fontawesome/css/fontawesome-all.min.css">
    <!-- animation css -->
    <link rel="stylesheet" href="assets/plugins/animation/css/animate.min.css">
    <!-- vendor css -->
    <link rel="stylesheet" href="assets/plugins/bootstrap/css/dataTable.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/custom.css">

    <script src="assets/plugins/jquery/js/jquery.min.js"></script>

    <!-- Required Js -->
    <script src="assets/js/vendor-all.min.js"></script>
    <script src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/pcoded.min.js"></script>

    <script src="assets/plugins/jquery-datatable/dataTable.min.js"></script>
    <script src="assets/plugins/bootstrap/js/bootstrapDataTable.min.js"></script>

</head>

<body>
    <!-- [ Pre-loader ] start -->
    <div class="loader-bg">
        <div class="loader-track">
            <div class="loader-fill"></div>
        </div>
    </div>
    <!-- [ Pre-loader ] End -->

    <!-- [ navigation menu ] start -->
    <nav class="pcoded-navbar">
        <div class="navbar-wrapper">
            <div class="navbar-brand header-logo">
                <a href="index1.html" class="b-brand">
                    <!-- <div class="b-bg"> -->
                    <!-- <i class="feather icon-trending-up"></i> -->
                    <img src="assets/images/z.png" height="40px" />
                    <!-- </div> -->
                    <span class="b-title">Zoom</span>
                </a>
                <a class="mobile-menu" id="mobile-collapse" href="javascript:"><span></span></a>
            </div>
            <div class="navbar-content scroll-div">
                <ul class="nav pcoded-inner-navbar">
                    <li data-username="dashboard Default" class="nav-item">
                        <a href="index.html" class="nav-link ">
                            <span class="pcoded-micon">
                                <i class="feather icon-home"></i>
                            </span>
                            <span class="pcoded-mtext">Dashboard</span>
                        </a>
                    </li>
                    <li data-username="customers" class="nav-item">
                        <a href="customers.html" class="nav-link ">
                            <span class="pcoded-micon">
                                <i class="feather icon-user"></i>
                            </span>
                            <span class="pcoded-mtext">Customers</span>
                        </a>
                    </li>
                    <li data-username="transactions" class="nav-item active">
                        <a href="transactions.html" class="nav-link ">
                            <span class="pcoded-micon">
                                <i class="fas fa-money-bill-wave"></i>
                            </span>
                            <span class="pcoded-mtext">Transactions</span>
                        </a>
                    </li>
                    <!-- <li data-username="transactions" class="nav-item">
                        <a href="transactionsAccord.html" class="nav-link ">
                            <span class="pcoded-micon">
                                <i class="fas fa-money-bill-wave"></i>
                            </span>
                            <span class="pcoded-mtext">Transactions1</span>
                        </a>
                    </li> -->
                </ul>
            </div>
        </div>
    </nav>
    <!-- [ navigation menu ] end -->

    <!-- [ Header ] start -->
    <header class="navbar pcoded-header navbar-expand-lg navbar-light">
        <div class="m-header">
            <a class="mobile-menu" id="mobile-collapse1" href="javascript:"><span></span></a>
            <a href="index1.html" class="b-brand">

                <!-- <i class="feather icon-trending-up"></i> -->
                <img src="assets/images/z.png" height="20px" />

                <span class="b-title">Zoom</span>
            </a>
        </div>
        <a class="mobile-menu" id="mobile-header" href="javascript:">
            <i class="feather icon-more-horizontal"></i>
        </a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav mr-auto">
                <li><a href="javascript:" class="full-screen" onclick="javascript:toggleFullScreen()"><i
                            class="feather icon-maximize"></i></a></li>
                <li class="nav-item">
                    <div class="main-search">
                        <div class="input-group">
                            <input type="text" id="m-search" class="form-control" placeholder="Search . . .">
                            <a href="javascript:" class="input-group-append search-close">
                                <i class="feather icon-x input-group-text"></i>
                            </a>
                            <span class="input-group-append search-btn btn btn-primary">
                                <i class="feather icon-search input-group-text"></i>
                            </span>
                        </div>
                    </div>
                </li>
            </ul>
            <ul class="navbar-nav ml-auto">
                <li>
                    <div class="dropdown drp-user">
                        <a href="javascript:" class="dropdown-toggle" data-toggle="dropdown">
                            <i class="icon feather icon-settings"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right profile-notification">
                            <div class="pro-head">
                                <img src="assets/images/user/avatar-1.jpg" class="img-radius" alt="User-Profile-Image">
                                <span>John Doe</span>
                                <!-- <a href="auth-signin.html" class="dud-logout" title="Logout">
                                    <i class="feather icon-log-out"></i>
                                </a> -->
                            </div>
                            <ul class="pro-body">
                                <li><a href="auth-signin.html" class="dropdown-item"><i
                                            class="feather icon-log-out"></i>
                                        Log Out</a></li>
                            </ul>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </header>
    <!-- [ Header ] end -->

    <!-- [ Main Content ] start -->
    <section class="pcoded-main-container">
        <div class="pcoded-wrapper">
            <div class="pcoded-content">
                <div class="pcoded-inner-content">
                    <!-- [ breadcrumb ] start -->
                    <div class="page-header">
                        <div class="page-block">
                            <div class="row align-items-center">
                                <div class="col-md-12">
                                    <div class="page-header-title">
                                        <h5 class="m-b-10">Zoom Customer Transactions
                                            <span style="float:right; font-size: 16px;">
                                                <label>Total Amount:</label>
                                                <span class="tAmount" style="font-weight: bold;"></span>
                                            </span>
                                        </h5>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- [ breadcrumb ] end -->
                    <div class="main-body">
                        <div class="page-wrapper">
                            <!-- [ Main Content ] start -->
                            <div class="row">
                                <!-- [ basic-table ] start -->
                                <div class="col-xl-12">
                                    <div class="card">
                                        <div class="card-block table-border-style">
                                            <div class="table-responsive">
                                                <table class="table table-sm" id="trxTbl">
                                                    <thead>
                                                        <tr>
                                                            <th>#</th>
                                                            <th>Date & Time</th>
                                                            <th>Trx Reference</th>
                                                            <th>Flow</th>
                                                            <th>Amount</th>
                                                            <th>Status</th>
                                                            <th>Action</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>

                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <!-- [ Main Content ] end -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script type="text/javascript">
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            var results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        };

        $(document).ready(function () {
            var trxTable;
            var appID = getUrlParameter('appId');
            $.ajax({
                url: "https://8gvfppglb0.execute-api.ap-south-1.amazonaws.com/apl/apl-details",
                type: "GET",
                crossDomain: true,
                //dataType: "jsonp",
                dataType: 'json',
                contentType: 'application/json',
                data: { "api_mode": 2, "app_id": appID },
                success: function (response) {
                    if (response.success == true) {
                        $(".tAmount").text(response.total_amount);

                        for (var i = 0, len = response.data.length; i < len; i++) {
                            var cDate = new Date(response.data[i].created_date);
                            var flowType;
                            if (response.data[i].transaction_type_id == 1) {
                                flowType = "P2M";
                            }
                            else if (response.data[i].transaction_type_id == 2) {
                                flowType = "Grocery";
                            }
                            else if (response.data[i].transaction_type_id == 3) {
                                flowType = "QSR";
                            }
                            var formatedCDate = ("0" + cDate.getDate()).slice(-2) + "/" + ("0" + (cDate.getMonth() + 1)).slice(-2) + '/' + cDate.getFullYear() + " &nbsp;&nbsp;&nbsp;" + ("0" + cDate.getHours()).slice(-2) + ":" + ("0" + cDate.getMinutes()).slice(-2) + ":" + ("0" + cDate.getSeconds()).slice(-2);

                            var rowList = '<tr id=' + response.data[i].app_id + '><th scope="row">' + (i + 1) + '</th><td>' + formatedCDate + '</td><td>' + response.data[i].transaction_reference + '</td><td>' + flowType + '</td><td>' + response.data[i].amount + '</td><td>' + (response.data[i].status_id == 2 ? "Success" : "Failed") + '</td><td>' + (flowType != "P2M" ? '<a class="viewTrxLink" data-toggle="modal" data-target="#viewItemsModal' + [i + 1] + '" id="' + (i + 1) + '">View Items</a>' : '<span></span>') + '</td></tr>';

                            $("#trxTbl tbody").append(rowList);

                            var invoiceData = response.data[i].invoice_details;
                            if (invoiceData != "") {

                                if (flowType == "QSR") {
                                    var oType = JSON.parse(JSON.parse(invoiceData).order_type);

                                    var oTypeValue;
                                    if (oType == "0") {
                                        oTypeValue = "Home Delivery";
                                    }
                                    if (oType == "1") {
                                        oTypeValue = "Self Pickup";
                                    }
                                    if (oType == "2") {
                                        oTypeValue = "Dine In";
                                    }
                                    if (oType == "3") {
                                        oTypeValue = "Take Away";
                                    }

                                    var QItemsData = JSON.parse(JSON.parse(invoiceData).items);

                                    var QdialogContent = '<div class="modal fade" id="viewItemsModal' + [i + 1] + '" tabindex="-1" role="dialog" aria-labelledby="viewItemsModalLabel' + [i + 1] + '" aria-hidden="true"><div class="modal-dialog modal-dialog-centered" role="document"><div class="modal-content"><div class="modal-header"><h5 class="modal-title storeName">' + response.data[i].store_name + '</h5></br><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><p class="oSummary" id="viewItemsModalLabel' + [i + 1] + '"><b>QSR </b> | ' + oTypeValue + ' | ' + formatedCDate + ' | &#8377;' + response.data[i].amount + '</p><div class="modal-body customMBody"><table class="table table-sm" id="itemsTbl' + [i + 1] + '"><thead><tr><th>Category</th><th>Item</th><th>Price</th><th>Quantity</th><th>Offer</th><th>Packaging</th><th>Tax</th><th>Cost</th></tr></thead><tbody></tbody></table ></div ></div ></div> </div>';


                                    $("body").append(QdialogContent);

                                    for (var idx = 0, lth = QItemsData.length; idx < lth; idx++) {
                                        var Qitems = '<tr><td>' + QItemsData[idx].category_name + '</td><td>' + (QItemsData[idx].image_url != "" ? '<img src=' + QItemsData[idx].image_url + ' height="20px" width="20px" class="itemIng"/>' : '<span></span>') + QItemsData[idx].item_name + '</td><td>' + QItemsData[idx].item_price + '</td><td>' + QItemsData[idx].add_item_quantity + '</td><td>' + QItemsData[idx].offer + '</td><td>' + (QItemsData[idx].packing_charge ? QItemsData[idx].packing_charge : 0) + '</td><td>' + (QItemsData[idx].TAXES ? '<span>CESS :' + QItemsData[idx].TAXES.CESS + '</span>|<span>CGST :' + QItemsData[idx].TAXES.CGST + '</span>|<span>SGST :' + QItemsData[idx].TAXES.SGST + '</span></br>' : 0) + '</td><td>' + QItemsData[idx].item_total + '</td></tr>'

                                        $("#itemsTbl" + [i + 1] + " tbody").append(Qitems);
                                    }
                                }


                                if (flowType == "Grocery") {
                                    var cDetails = JSON.parse(JSON.parse(invoiceData).data.contact_details);
                                    var GItemsData = JSON.parse(cDetails.items);

                                    var GdialogContent = '<div class="modal fade" id="viewItemsModal' + [i + 1] + '" tabindex="-1" role="dialog" aria-labelledby="viewItemsModalLabel' + [i + 1] + '" aria-hidden="true"><div class="modal-dialog modal-dialog-centered" role="document"><div class="modal-content"><div class="modal-header"><h5 class="modal-title storeName">' + response.data[i].store_name + '</h5></br><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><p class="oSummary" id="viewItemsModalLabel' + [i + 1] + '"><b>Grocery </b> | ' + formatedCDate + ' | &#8377;' + response.data[i].amount + '</p><div class="modal-body customMBody"><table class="table table-sm" id="itemsTbl' + [i + 1] + '"><thead><tr><th>Item</th><th>Price</th><th>Quantity</th><th>GST</th><th>Amount</th></tr></thead><tbody></tbody></table ></div ></div ></div> </div>';

                                    $("body").append(GdialogContent);


                                    for (var ind = 0, lth = GItemsData.length; ind < lth; ind++) {
                                        var Gitems = '<tr><td>' + GItemsData[ind].name + '</td><td>' + GItemsData[ind].rate + '</td><td>' + GItemsData[ind].quantity + '</td><td>' + GItemsData[ind].gst + '</td><td>' + GItemsData[ind].amount + '</td></tr>'

                                        $("#itemsTbl" + [i + 1] + " tbody").append(Gitems);
                                    }
                                }
                            }
                        }

                        trxTable = $('#trxTbl').DataTable(
                            {
                                "pagingType": "numbers",
                                "pageLength": 10,
                                "lengthChange": true,
                                "ordering": false,
                                "info": false,
                                "bFilter": true,
                            }
                        );

                    }
                }
            });

        });
    </script>
</body>

</html>
